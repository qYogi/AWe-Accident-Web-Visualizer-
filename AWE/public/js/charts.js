var b=new Map,p=!1;function u(e,c,r,o){let a=b.get(e);if(a)a.data=r,a.update();else{let n=document.getElementById(e);n&&(a=new window.Chart(n,{type:c,data:r,options:o}),b.set(e,a))}}function h(e){return b.get(e)}function f(e,c){let r=e.data.datasets[0].data,a=e.data.labels.map((i,l)=>({Label:i,Value:r[l]})),n=window.Papa.unparse(a),s=new Blob([n],{type:"text/csv;charset=utf-8;"}),t=document.createElement("a"),d=URL.createObjectURL(s);t.setAttribute("href",d),t.setAttribute("download",`${c}.csv`),document.body.appendChild(t),t.click(),document.body.removeChild(t)}async function y(e,c,r){let o={type:e.config.type,data:e.data,options:e.options},s=`https://quickchart.io/chart?c=${encodeURIComponent(JSON.stringify(o))}&width=500&height=300&format=${r}`;try{let t=await fetch(s);if(!t.ok)throw new Error(`QuickChart.io request failed: ${t.statusText}`);let d=await t.blob(),i=document.createElement("a"),l=URL.createObjectURL(d);i.href=l,i.download=`${c}.${r}`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(l)}catch(t){console.error("Failed to download chart image.",t)}}function g(){document.querySelectorAll(".chart-export-btn").forEach(e=>{e.addEventListener("click",async c=>{let r=c.currentTarget,o=r.dataset.chart,a=r.dataset.format;if(!o||!a){console.error("Error on chartId or format.");return}let n=h(o);if(!n){console.error(`Chart instance with id ${o} not found.`);return}a==="csv"?f(n,o):(a==="webp"||a==="svg")&&await y(n,o,a)})}),p=!0}function m(e){let c=[0,0,0,0];e.forEach(s=>{let t=parseInt(s.severity);t>=1&&t<=4&&c[t-1]++}),u("severityChart","bar",{labels:["1","2","3","4"],datasets:[{label:"Number of Accidents",data:c,backgroundColor:["#4e79a7","#f28e2b","#e15759","#76b7b2"]}]},{responsive:!0,plugins:{legend:{display:!1},title:{display:!0,text:"Accident Severity Distribution"}},scales:{y:{beginAtZero:!0,title:{display:!0,text:"Number of Accidents"}},x:{title:{display:!0,text:"Severity Level"}}}});let r={};e.forEach(s=>{let t=new Date(s.start_time).toLocaleDateString();r[t]=(r[t]||0)+1});let o=Object.keys(r).sort(),a=o.map(s=>r[s]);u("trendChart","line",{labels:o,datasets:[{label:"Accidents",data:a,borderColor:"#4e79a7",backgroundColor:"rgba(78,121,167,0.1)",tension:.2}]},{responsive:!0,plugins:{legend:{display:!1},title:{display:!0,text:"Accident Trends Over Time"}},scales:{y:{beginAtZero:!0,title:{display:!0,text:"Number of Accidents"}},x:{title:{display:!0,text:"Date"}}}});let n=Array(24).fill(0);e.forEach(s=>{let t=new Date(s.start_time).getHours();n[t]++}),u("hourChart","bar",{labels:Array.from({length:24},(s,t)=>t+":00"),datasets:[{label:"Accidents",data:n,backgroundColor:"#4e79a7"}]},{responsive:!0,plugins:{legend:{display:!1},title:{display:!0,text:"Accidents by Hour of Day"}},scales:{y:{beginAtZero:!0,title:{display:!0,text:"Number of Accidents"}},x:{title:{display:!0,text:"Hour of Day"}}}}),p||g()}var C=m;export{C as default};
