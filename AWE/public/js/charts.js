var h=new Map,p=!1;async function b(){window.Chart||await new Promise((e,n)=>{let a=document.createElement("script");a.src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js",a.onload=()=>e(),a.onerror=()=>n(new Error("Failed to load Chart.js")),document.head.appendChild(a)})}async function u(e,n,a,o){await b();let r=h.get(e);if(r)r.data=a,r.update();else{let s=document.getElementById(e);s&&(r=new window.Chart(s,{type:n,data:a,options:o}),h.set(e,r))}}function f(e){return h.get(e)}function y(e,n){let a=e.data.datasets[0].data,r=e.data.labels.map((i,l)=>({Label:i,Value:a[l]})),s=window.Papa.unparse(r),c=new Blob([s],{type:"text/csv;charset=utf-8;"}),t=document.createElement("a"),d=URL.createObjectURL(c);t.setAttribute("href",d),t.setAttribute("download",`${n}.csv`),document.body.appendChild(t),t.click(),document.body.removeChild(t)}async function m(e,n,a){let o={type:e.config.type,data:e.data,options:e.options},c=`https://quickchart.io/chart?c=${encodeURIComponent(JSON.stringify(o))}&width=500&height=300&format=${a}`;try{let t=await fetch(c);if(!t.ok)throw new Error(`QuickChart.io request failed: ${t.statusText}`);let d=await t.blob(),i=document.createElement("a"),l=URL.createObjectURL(d);i.href=l,i.download=`${n}.${a}`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(l)}catch(t){console.error("Failed to download chart image.",t)}}function g(){document.querySelectorAll(".chart-export-btn").forEach(e=>{e.addEventListener("click",async n=>{let a=n.currentTarget,o=a.dataset.chart,r=a.dataset.format;if(!o||!r){console.error("Error on chartId or format.");return}let s=f(o);if(!s){console.error(`Chart instance with id ${o} not found.`);return}r==="csv"?y(s,o):(r==="webp"||r==="svg")&&await m(s,o,r)})}),p=!0}function w(e){let n=[0,0,0,0];e.forEach(c=>{let t=parseInt(c.severity);t>=1&&t<=4&&n[t-1]++}),u("severityChart","bar",{labels:["1","2","3","4"],datasets:[{label:"Number of Accidents",data:n,backgroundColor:["#4e79a7","#f28e2b","#e15759","#76b7b2"]}]},{responsive:!0,plugins:{legend:{display:!1},title:{display:!0,text:"Accident Severity Distribution"}},scales:{y:{beginAtZero:!0,title:{display:!0,text:"Number of Accidents"}},x:{title:{display:!0,text:"Severity Level"}}}});let a={};e.forEach(c=>{let t=new Date(c.start_time).toLocaleDateString();a[t]=(a[t]||0)+1});let o=Object.keys(a).sort(),r=o.map(c=>a[c]);u("trendChart","line",{labels:o,datasets:[{label:"Accidents",data:r,borderColor:"#4e79a7",backgroundColor:"rgba(78,121,167,0.1)",tension:.2}]},{responsive:!0,plugins:{legend:{display:!1},title:{display:!0,text:"Accident Trends Over Time"}},scales:{y:{beginAtZero:!0,title:{display:!0,text:"Number of Accidents"}},x:{title:{display:!0,text:"Date"}}}});let s=Array(24).fill(0);e.forEach(c=>{let t=new Date(c.start_time).getHours();s[t]++}),u("hourChart","bar",{labels:Array.from({length:24},(c,t)=>t+":00"),datasets:[{label:"Accidents",data:s,backgroundColor:"#4e79a7"}]},{responsive:!0,plugins:{legend:{display:!1},title:{display:!0,text:"Accidents by Hour of Day"}},scales:{y:{beginAtZero:!0,title:{display:!0,text:"Number of Accidents"}},x:{title:{display:!0,text:"Hour of Day"}}}}),p||g()}var C=w;export{C as default};
