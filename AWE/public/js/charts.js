var c=new Map,u=!1;function d(e,n,i,l){let a=c.get(e);if(a)a.data=i,a.update();else{let r=document.getElementById(e);r&&(a=new window.Chart(r,{type:n,data:i,options:l}),c.set(e,a))}}function p(e){return c.get(e)}function y(e,n){let i=e.data.datasets[0].data,l=e.data.labels.map((s,b)=>({Label:s,Value:i[b]})),a=window.Papa.unparse(l),r=new Blob([a],{type:"text/csv;charset=utf-8;"}),o=document.createElement("a"),t=URL.createObjectURL(r);o.setAttribute("href",t),o.setAttribute("download",`${n}.csv`),document.body.appendChild(o),o.click(),document.body.removeChild(o)}async function f(e,n,i){let l={type:e.config.type,data:e.data,options:e.options},a=`https://quickchart.io/chart?c=${encodeURIComponent(JSON.stringify(l))}&width=500&height=300&format=${i}`;try{let r=await fetch(a);if(!r.ok)throw new Error(`QuickChart.io request failed: ${r.statusText}`);let o=await r.blob(),t=document.createElement("a"),s=URL.createObjectURL(o);t.href=s,t.download=`${n}.${i}`,document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(s)}catch(r){console.error("Failed to download chart image.",r)}}function h(){document.querySelectorAll(".chart-export-btn").forEach(e=>{e.addEventListener("click",async n=>{let i=n.currentTarget,l=i.dataset.chart,a=i.dataset.format;if(!l||!a){console.error("Error on chartId or format.");return}let r=p(l);if(!r){console.error(`Chart instance with id ${l} not found.`);return}a==="csv"?y(r,l):(a==="webp"||a==="svg")&&await f(r,l,a)})}),u=!0}function m(e){let n=[0,0,0,0];e.forEach(o=>{let t=parseInt(o.severity);t>=1&&t<=4&&n[t-1]++}),d("severityChart","bar",{labels:["1","2","3","4"],datasets:[{label:"Number of Accidents",data:n,backgroundColor:["#4e79a7","#f28e2b","#e15759","#76b7b2"]}]},{responsive:!0,plugins:{legend:{display:!1},title:{display:!0,text:"Accident Severity Distribution"}},scales:{y:{beginAtZero:!0,title:{display:!0,text:"Number of Accidents"}},x:{title:{display:!0,text:"Severity Level"}}}});let i={};e.forEach(o=>{let t=new Date(o.start_time).toLocaleDateString();i[t]=(i[t]||0)+1});let l=Object.keys(i).sort(),a=l.map(o=>i[o]);d("trendChart","line",{labels:l,datasets:[{label:"Accidents",data:a,borderColor:"#4e79a7",backgroundColor:"rgba(78,121,167,0.1)",tension:.2}]},{responsive:!0,plugins:{legend:{display:!1},title:{display:!0,text:"Accident Trends Over Time"}},scales:{y:{beginAtZero:!0,title:{display:!0,text:"Number of Accidents"}},x:{title:{display:!0,text:"Date"}}}});let r=Array(24).fill(0);e.forEach(o=>{let t=new Date(o.start_time).getHours();r[t]++}),d("hourChart","bar",{labels:Array.from({length:24},(o,t)=>t+":00"),datasets:[{label:"Accidents",data:r,backgroundColor:"#4e79a7"}]},{responsive:!0,plugins:{legend:{display:!1},title:{display:!0,text:"Accidents by Hour of Day"}},scales:{y:{beginAtZero:!0,title:{display:!0,text:"Number of Accidents"}},x:{title:{display:!0,text:"Hour of Day"}}}}),u||h()}var g=m;export{g as default};
