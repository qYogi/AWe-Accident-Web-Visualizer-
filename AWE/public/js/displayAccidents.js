var g=null,u=[];function p(s){g&&(u.forEach(r=>r.remove()),u=[],s.forEach(r=>{if(r.start_lat&&r.start_lng){let t=window.L.marker([Number(r.start_lat),Number(r.start_lng)]);t.addTo(g),u.push(t)}}))}var m=new Map,w=!1;async function C(){window.Chart||await new Promise((s,r)=>{let t=document.createElement("script");t.src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js",t.onload=()=>s(),t.onerror=()=>r(new Error("Failed to load Chart.js")),document.head.appendChild(t)})}async function h(s,r,t,o){await C();let a=m.get(s);if(a)a.data=t,a.update();else{let i=document.getElementById(s);i&&(a=new window.Chart(i,{type:r,data:t,options:o}),m.set(s,a))}}function S(s){return m.get(s)}function E(s,r){let t=s.data.datasets[0].data,a=s.data.labels.map((l,d)=>({Label:l,Value:t[d]})),i=window.Papa.unparse(a),n=new Blob([i],{type:"text/csv;charset=utf-8;"}),e=document.createElement("a"),c=URL.createObjectURL(n);e.setAttribute("href",c),e.setAttribute("download",`${r}.csv`),document.body.appendChild(e),e.click(),document.body.removeChild(e)}async function x(s,r,t){let o={type:s.config.type,data:s.data,options:s.options},n=`https://quickchart.io/chart?c=${encodeURIComponent(JSON.stringify(o))}&width=500&height=300&format=${t}`;try{let e=await fetch(n);if(!e.ok)throw new Error(`QuickChart.io request failed: ${e.statusText}`);let c=await e.blob(),l=document.createElement("a"),d=URL.createObjectURL(c);l.href=d,l.download=`${r}.${t}`,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(d)}catch(e){console.error("Failed to download chart image.",e)}}function L(){document.querySelectorAll(".chart-export-btn").forEach(s=>{s.addEventListener("click",async r=>{let t=r.currentTarget,o=t.dataset.chart,a=t.dataset.format;if(!o||!a){console.error("Error on chartId or format.");return}let i=S(o);if(!i){console.error(`Chart instance with id ${o} not found.`);return}a==="csv"?E(i,o):(a==="webp"||a==="svg")&&await x(i,o,a)})}),w=!0}function v(s){let r=[0,0,0,0];s.forEach(n=>{let e=parseInt(n.severity);e>=1&&e<=4&&r[e-1]++}),h("severityChart","bar",{labels:["1","2","3","4"],datasets:[{label:"Number of Accidents",data:r,backgroundColor:["#4e79a7","#f28e2b","#e15759","#76b7b2"]}]},{responsive:!0,plugins:{legend:{display:!1},title:{display:!0,text:"Accident Severity Distribution"}},scales:{y:{beginAtZero:!0,title:{display:!0,text:"Number of Accidents"}},x:{title:{display:!0,text:"Severity Level"}}}});let t={};s.forEach(n=>{let e=new Date(n.start_time).toLocaleDateString();t[e]=(t[e]||0)+1});let o=Object.keys(t).sort(),a=o.map(n=>t[n]);h("trendChart","line",{labels:o,datasets:[{label:"Accidents",data:a,borderColor:"#4e79a7",backgroundColor:"rgba(78,121,167,0.1)",tension:.2}]},{responsive:!0,plugins:{legend:{display:!1},title:{display:!0,text:"Accident Trends Over Time"}},scales:{y:{beginAtZero:!0,title:{display:!0,text:"Number of Accidents"}},x:{title:{display:!0,text:"Date"}}}});let i=Array(24).fill(0);s.forEach(n=>{let e=new Date(n.start_time).getHours();i[e]++}),h("hourChart","bar",{labels:Array.from({length:24},(n,e)=>e+":00"),datasets:[{label:"Accidents",data:i,backgroundColor:"#4e79a7"}]},{responsive:!0,plugins:{legend:{display:!1},title:{display:!0,text:"Accidents by Hour of Day"}},scales:{y:{beginAtZero:!0,title:{display:!0,text:"Number of Accidents"}},x:{title:{display:!0,text:"Hour of Day"}}}}),w||L()}var f=v;var b=class{constructor(){this.currentSort=null,this.originalData=[],this.setupSorting()}setData(r){this.originalData=[...r]}setupSorting(){let r=document.querySelector("#accidents-table-head");r&&r.addEventListener("click",t=>{let o=t.target;if(o.tagName==="TH"&&o.classList.contains("sortable-header")){let a=o.getAttribute("data-column");a&&this.handleSort(a)}})}handleSort(r){if(!this.originalData.length)return;let t;if(!this.currentSort||this.currentSort.column!==r)t="asc";else switch(this.currentSort.state){case"asc":t="desc";break;case"desc":t="neutral";break;default:t="asc"}this.currentSort=t==="neutral"?null:{column:r,state:t},this.updateSortIndicators(r,t);let o=this.sortData(this.originalData,r,t);this.displaySortedData(o)}sortData(r,t,o){return o==="neutral"?[...this.originalData]:[...r].sort((i,n)=>{let e=i[t],c=n[t];return t==="severity"?(e=parseFloat(e)||0,c=parseFloat(c)||0):t==="start_time"||t==="end_time"?(e=new Date(e).getTime(),c=new Date(c).getTime()):(e=(e||"").toString().toLowerCase(),c=(c||"").toString().toLowerCase()),e<c?o==="asc"?-1:1:e>c?o==="asc"?1:-1:0})}updateSortIndicators(r,t){document.querySelectorAll("#accidents-table-head th.sortable-header").forEach(a=>{let i=a,n=i.getAttribute("data-column");i.classList.remove("sort-asc","sort-desc","sort-neutral"),n===r?i.classList.add(`sort-${t}`):i.classList.add("sort-neutral")})}displaySortedData(r){let t=document.querySelector("#accidents-table tbody");t&&(t.innerHTML="",r.forEach(o=>{let a=document.createElement("tr");["id","severity","start_time","end_time","description","street","city","county","state","country"].forEach(n=>{let e=document.createElement("td"),c=o[n]||"";n.includes("time")&&c&&(c=new Date(c).toLocaleString()),e.textContent=c,e.setAttribute("title",c),a.appendChild(e)}),t.appendChild(a)}))}createSortableHeaders(){let r=document.querySelector("#accidents-table-head");if(!r)return;let t=["severity","start_time","end_time","street","city","state"];r.querySelectorAll("th").forEach((a,i)=>{let n=a.textContent?.toLowerCase().replace(/\s+/g,"_")||"";t.includes(n)&&(a.classList.add("sortable-header"),a.setAttribute("data-column",n),a.classList.add("sort-neutral"))})}resetSorting(){this.currentSort=null,this.updateSortIndicators("","neutral"),this.displaySortedData(this.originalData)}},y=new b;function j(s){if("error"in s){let n=document.querySelector("#accidents-table-head"),e=document.querySelector("#accidents-table tbody");if(!n||!e)return;n.innerHTML="",e.innerHTML="";let c=document.createElement("tr"),l=document.createElement("td");l.colSpan=10,l.style.cssText="text-align: center; color: #e15759; font-weight: bold; padding: 2rem;",l.textContent=s.error,c.appendChild(l),e.appendChild(c);let d=document.getElementById("pagination-controls");d&&(d.innerHTML=""),p([]),f([]);return}let{accidents:r}=s,t=document.querySelector("#accidents-table-head"),o=document.querySelector("#accidents-table tbody");if(!t||!o)return;t.innerHTML="",o.innerHTML="";let a=["id","severity","start_time","end_time","description","street","city","county","state","country"],i=document.createElement("tr");a.forEach(n=>{let e=document.createElement("th");e.textContent=n.split("_").map(c=>c.charAt(0).toUpperCase()+c.slice(1)).join(" "),e.setAttribute("title",e.textContent),i.appendChild(e)}),t.appendChild(i),y.setData(r),y.createSortableHeaders(),r.forEach(n=>{let e=document.createElement("tr");a.forEach(c=>{let l=document.createElement("td"),d=n[c]||"";c.includes("time")&&d&&(d=new Date(d).toLocaleString()),l.textContent=d,l.setAttribute("title",d),e.appendChild(l)}),o.appendChild(e)}),p(r),f(r)}function q(s,r,t,o){if(s.innerHTML="",t<=1)return;let a=document.createElement("select");a.className="pagination-select";for(let n=1;n<=t;n++){let e=document.createElement("option");e.value=n.toString(),e.textContent=`Page ${n} of ${t}`,n===r&&(e.selected=!0),a.appendChild(e)}a.addEventListener("change",n=>{let e=parseInt(n.target.value,10);o(e)});let i=document.createElement("label");i.textContent="Go to page: ",i.appendChild(a),s.appendChild(i)}export{q as createPagination,j as displayAccidents};
